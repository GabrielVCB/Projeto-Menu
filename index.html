<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card√°pio - Sabor a Mezza</title>
    <link rel="stylesheet" href="./css/index.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="admin-buttons" id="admin-buttons" style="display: none">
      <button onclick="window.location.href='admin.html'" class="admin-btn">
        Gerenciar Produtos
      </button>
      <button onclick="logout()" class="admin-btn">Sair</button>
    </div>
    <div class="cardapio">
      <header>
        <img src="./assets/images/logonome.jpg" alt="Logo" class="logo" />
      </header>
      <div class="categorias">
        <div class="coluna">
          <h2 class="titulo">LANCHES</h2>
          <ul class="itens">
            <li>Coxinha <span class="preco-produto">R$ 7,00</span></li>
            <li>
              Coxinha Frango + Requeij√£o
              <span class="preco-produto">R$ 8,00</span>
            </li>
            <li>Coxinha Charque <span class="preco-produto">R$ 10,00</span></li>
            <li>Croissant <span class="preco-produto">R$ 9,00</span></li>
            <li>
              Empada de Bacalhau <span class="preco-produto">R$ 10,00</span>
            </li>
            <li>Empada de Frango <span class="preco-produto">R$ 9,00</span></li>
            <li>P√£o Del√≠cia <span class="preco-produto">R$ 9,00</span></li>
            <li>Esfirra <span class="preco-produto">R$ 9,00</span></li>
            <li>Hamb√∫rguer <span class="preco-produto">R$ 8,00</span></li>
            <li>Cachorro Quente <span class="preco-produto">R$ 8,00</span></li>
            <li>Sandu√≠che Misto <span class="preco-produto">R$ 7,00</span></li>
            <li>
              Sandu√≠che Natural <span class="preco-produto">R$ 14,00</span>
            </li>
            <li>Tapioca <span class="preco-produto">R$ 10,00</span></li>
            <li>Salada de Fruta <span class="preco-produto">R$ 9,00</span></li>
            <li>Fatia de Bolo <span class="preco-produto">R$ 9,00</span></li>
            <!-- Produtos adicionados pelo admin ser√£o inseridos aqui -->
            <div id="lanches-admin"></div>
          </ul>
        </div>
        <div class="coluna">
          <h2 class="titulo">BEBIDAS</h2>
          <ul class="itens">
            <li>√Ågua <span class="preco-produto">R$ 2,00</span></li>
            <li>√Ågua Indai√° <span class="preco-produto">R$ 3,00</span></li>
            <li>√Ågua com G√°s <span class="preco-produto">R$ 4,00</span></li>
            <li>Caf√© Pequeno <span class="preco-produto">R$ 2,00</span></li>
            <li>Caf√© Grande <span class="preco-produto">R$ 3,00</span></li>
            <li>Caf√© com Leite <span class="preco-produto">R$ 4,00</span></li>
            <li>Suco <span class="preco-produto">R$ 6,00</span></li>
            <li>Suco com Leite <span class="preco-produto">R$ 7,00</span></li>
            <li>
              Refrigerante Mini <span class="preco-produto">R$ 4,00</span>
            </li>
            <li>
              Refrigerante Lata <span class="preco-produto">R$ 6,00</span>
            </li>
            <li>H2O Limoneto <span class="preco-produto">R$ 6,00</span></li>
            <!-- Produtos adicionados pelo admin ser√£o inseridos aqui -->
            <div id="bebidas-admin"></div>
          </ul>
        </div>
      </div>
      <div class="extras">
        <h2>Refei√ß√µes</h2>
        <ul>
          <li>Sopa 250ml <span class="preco-produto">R$ 10,00</span></li>
          <li>Sopa 500ml <span class="preco-produto">R$ 13,00</span></li>
          <li>Cuscuz Recheado <span class="preco-produto">R$ 13,00</span></li>
          <!-- Produtos adicionados pelo admin ser√£o inseridos aqui -->
        </ul>
      </div>
      <footer>
        <p>@LANCHONETE.SABORAMEZZA</p>
      </footer>
    </div>
    <script src="./js/storage.js"></script>
    <script>
      // Verifica se est√° no modo admin
      if (localStorage.getItem("adminLoggedIn") === "true") {
        document.getElementById("admin-buttons").style.display = "flex";
      }

      // Fun√ß√£o para fazer logout
      function logout() {
        localStorage.removeItem("adminLoggedIn");
        location.reload();
      }

      // Fun√ß√£o para formatar o pre√ßo
      function formatarPreco(preco) {
        return `R$ ${preco.toFixed(2).replace(".", ",")}`;
      }

      // Fun√ß√£o para renderizar os produtos adicionados pelo admin
      function renderizarProdutosAdmin() {
        const produtos = getProdutos();
        const lanchesAdmin = document.getElementById("lanches-admin");
        const bebidasAdmin = document.getElementById("bebidas-admin");
        const refeicoesUl = document.querySelector(".extras ul");

        // Limpa as se√ß√µes
        lanchesAdmin.innerHTML = "";
        bebidasAdmin.innerHTML = "";
        Array.from(refeicoesUl.querySelectorAll(".admin-refeicao")).forEach(
          (el) => el.remove()
        );

        // Adiciona os produtos em suas respectivas categorias
        produtos.forEach((produto) => {
          const item = document.createElement("li");
          item.classList.add("admin-refeicao");
          item.innerHTML = `
            ${produto.nome}
            <span class="preco-e-excluir">
              <span class="preco-produto">${formatarPreco(produto.preco)}</span>
              ${
                localStorage.getItem("adminLoggedIn") === "true"
                  ? `<button onclick="deletarProduto(${produto.id})" class="delete-btn">üóëÔ∏è</button>`
                  : ""
              }
            </span>
          `;
          switch (produto.categoria) {
            case "LANCHES":
              lanchesAdmin.appendChild(item);
              break;
            case "BEBIDAS":
              bebidasAdmin.appendChild(item);
              break;
            case "REFEI√á√ïES":
              refeicoesUl.appendChild(item);
              break;
          }
        });
      }

      // Adiciona bot√£o de excluir em todos os itens fixos para admin
      function adicionarBotaoExcluirEmTodosOsItens() {
        if (localStorage.getItem("adminLoggedIn") === "true") {
          document
            .querySelectorAll(".itens li, .extras ul li")
            .forEach((li) => {
              if (!li.querySelector(".delete-btn")) {
                // Encontra o span do pre√ßo
                let precoSpan = li.querySelector(".preco-produto");
                if (precoSpan) {
                  // Cria o agrupador se n√£o existir
                  let precoEExcluir = precoSpan.parentNode;
                  if (!precoEExcluir.classList.contains("preco-e-excluir")) {
                    precoEExcluir = document.createElement("span");
                    precoEExcluir.className = "preco-e-excluir";
                    precoSpan.parentNode.insertBefore(precoEExcluir, precoSpan);
                    precoEExcluir.appendChild(precoSpan);
                  }
                  // Cria o bot√£o de excluir
                  const btn = document.createElement("button");
                  btn.className = "delete-btn";
                  btn.innerHTML = "üóëÔ∏è";
                  btn.onclick = function () {
                    if (confirm("Tem certeza que deseja excluir este item?")) {
                      li.remove();
                    }
                  };
                  precoEExcluir.appendChild(btn);
                }
              }
            });
        }
      }

      function salvarEdicao(id) {
        const nome = document.getElementById(`nome-${id}`).value;
        const preco = parseFloat(document.getElementById(`preco-${id}`).value);
        if (nome && preco) {
          updateProduto(id, { nome, preco });
          alert("Produto atualizado!");
          location.reload();
        } else {
          alert("Preencha todos os campos!");
        }
      }

      // Fun√ß√£o para deletar produto
      function deletarProduto(id) {
        if (confirm("Tem certeza que deseja excluir este produto?")) {
          removeProduto(id);
          alert("Produto exclu√≠do com sucesso!");
          location.reload();
        }
      }

      // Chama as fun√ß√µes ao carregar a p√°gina
      document.addEventListener("DOMContentLoaded", () => {
        renderizarProdutosAdmin();
        adicionarBotaoExcluirEmTodosOsItens();
      });
    </script>
  </body>
</html>
